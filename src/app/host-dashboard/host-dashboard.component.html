<div class="host-dashboard-container">
  <!-- Header -->
  <div class="dashboard-header">
    <div>
      <h1>ğŸ  Host Dashboard</h1>
      <p>Manage your properties, bookings, and complaints</p>
    </div>
    <div>
      <button class="btn-logout" (click)="logout()" [disabled]="loading.logout">
        <span class="icon">ğŸšª</span>
        <span *ngIf="!loading.logout">Logout</span>
        <span *ngIf="loading.logout">Logging out...</span>
      </button>
    </div>
  </div>

  <!-- Alert Messages -->
  <div class="alert-container">
    <div *ngIf="successMessage" class="alert alert-success">
      âœ“ {{ successMessage }}
    </div>
    <div *ngIf="errorMessage" class="alert alert-danger">
      âœ— {{ errorMessage }}
    </div>
  </div>

  <!-- Navigation Tabs -->
  <div class="dashboard-tabs">
    <button class="tab-btn" [class.active]="activeTab === 'properties'" (click)="switchTab('properties')">
      ğŸ¡ My Properties ({{ properties.length }})
    </button>
    <button class="tab-btn" [class.active]="activeTab === 'deleted'" (click)="switchTab('deleted')">
      ğŸ—‘ï¸ Deleted Properties ({{ deletedProperties.length }})
    </button>
    <button class="tab-btn" [class.active]="activeTab === 'bookings'" (click)="switchTab('bookings')">
      ğŸ“… Bookings ({{ bookings.length }})
    </button>
    <button class="tab-btn" [class.active]="activeTab === 'complaints'" (click)="switchTab('complaints')">
      ğŸ“ Submit Complaint
    </button>
  </div>

  <!-- ==================== TAB 1: MY PROPERTIES ==================== -->
  <div *ngIf="activeTab === 'properties'" class="tab-content">
    <div class="content-header">
      <h2>My Properties</h2>
      <button class="btn btn-primary" (click)="openAddPropertyForm()">
        â• Add New Property
      </button>
    </div>

    <!-- Properties Grid -->
    <div class="properties-grid" *ngIf="properties.length > 0">
      <div class="property-card" *ngFor="let property of properties">
        <div class="property-image">
          <img [src]="property.imageURL || 'assets/placeholder-property.jpg'" [alt]="property.propertyName">
          <span class="status-badge" [ngClass]="getStatusBadgeClass(property.propertyStatus)">
            {{ property.propertyStatus }}
          </span>
        </div>

        <div class="property-details">
          <h3>{{ property.propertyName }}</h3>
          <p class="property-location">ğŸ“ {{ property.city }}, {{ property.state }}, {{ property.country }}</p>

          <div class="property-stats">
            <span>ğŸ›ï¸ {{ property.noOfRooms }} Rooms</span>
            <span>ğŸš¿ {{ property.noOfBathrooms }} Baths</span>
            <span>ğŸ‘¥ {{ property.maxNoOfGuests }} Guests</span>
          </div>

          <div class="property-amenities">
            <span *ngIf="property.hasWifi" title="WiFi">ğŸ“¶</span>
            <span *ngIf="property.hasParking" title="Parking">ğŸ…¿ï¸</span>
            <span *ngIf="property.hasPool" title="Pool">ğŸŠ</span>
            <span *ngIf="property.hasAc" title="AC">â„ï¸</span>
            <span *ngIf="property.hasHeater" title="Heater">ğŸ”¥</span>
            <span *ngIf="property.hasPetFriendly" title="Pet Friendly">ğŸ•</span>
          </div>

          <div class="property-rating">
            <span class="stars">{{ getRatingStars(property.propertyRate) }}</span>
            <span class="rating-text">{{ property.propertyRate.toFixed(1) }} ({{ property.propertyRatingCount }}
              reviews)</span>
          </div>

          <div class="property-price">
            <strong>â‚¹{{ property.pricePerDay }}</strong> / night
          </div>

          <div class="property-actions">
            <button class="btn btn-sm btn-info" (click)="viewPropertyDetails(property.propertyId)">
              ğŸ‘ï¸ View
            </button>
            <button class="btn btn-sm btn-warning" (click)="openEditPropertyForm(property)">
              âœï¸ Edit
            </button>
            <button class="btn btn-sm btn-danger" (click)="deleteProperty(property.propertyId)">
              ğŸ—‘ï¸ Delete
            </button>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="properties.length === 0" class="empty-state">
      <p>ğŸ“­ No properties found. Add your first property!</p>
    </div>
  </div>

  <!-- ==================== TAB 2: DELETED PROPERTIES ==================== -->
  <div *ngIf="activeTab === 'deleted'" class="tab-content">
    <div class="content-header">
      <h2>Deleted Properties</h2>
    </div>

    <div class="properties-grid" *ngIf="deletedProperties.length > 0">
      <div class="property-card deleted" *ngFor="let property of deletedProperties">
        <div class="property-image">
          <img [src]="property.imageURL || 'assets/placeholder-property.jpg'" [alt]="property.propertyName">
          <span class="status-badge badge-danger">DELETED</span>
        </div>

        <div class="property-details">
          <h3>{{ property.propertyName }}</h3>
          <p class="property-location">ğŸ“ {{ property.city }}, {{ property.state }}</p>

          <div class="property-stats">
            <span>ğŸ›ï¸ {{ property.noOfRooms }} Rooms</span>
            <span>ğŸš¿ {{ property.noOfBathrooms }} Baths</span>
            <span>ğŸ‘¥ {{ property.maxNoOfGuests }} Guests</span>
          </div>

          <div class="property-price">
            <strong>â‚¹{{ property.pricePerDay }}</strong> / night
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="deletedProperties.length === 0" class="empty-state">
      <p>ğŸ“­ No deleted properties</p>
    </div>
  </div>

  <!-- ==================== TAB 3: BOOKINGS ==================== -->
  <div *ngIf="activeTab === 'bookings'" class="tab-content">
    <div class="content-header">
      <h2>Bookings on My Properties</h2>
    </div>

    <div class="bookings-list" *ngIf="bookings.length > 0">
      <div class="booking-card" *ngFor="let booking of bookings">
        <div class="booking-image">
          <img [src]="booking.propertyImage || 'assets/placeholder-property.jpg'" [alt]="booking.propertyName">
        </div>

        <div class="booking-details">
          <h3>{{ booking.propertyName }}</h3>
          <p class="booking-location">ğŸ“ {{ booking.city }}</p>

          <div class="booking-info">
            <div class="info-row">
              <span class="label">Guest:</span>
              <span class="value">{{ booking.username }}</span>
            </div>
            <div class="info-row">
              <span class="label">Check-in:</span>
              <span class="value">{{ booking.checkinDate | date:'mediumDate' }}</span>
            </div>
            <div class="info-row">
              <span class="label">Check-out:</span>
              <span class="value">{{ booking.checkoutDate | date:'mediumDate' }}</span>
            </div>
            <div class="info-row">
              <span class="label">Status:</span>
              <span class="value">
                <span class="badge" [ngClass]="getStatusBadgeClass(booking.isBookingStatus)">
                  {{ booking.isBookingStatus }}
                </span>
              </span>
            </div>
            <div class="info-row">
              <span class="label">Payment:</span>
              <span class="value">
                <span [class.paid]="booking.isPaymentStatus" [class.unpaid]="!booking.isPaymentStatus">
                  {{ booking.isPaymentStatus ? 'âœ“ Paid' : 'âœ— Unpaid' }}
                </span>
              </span>
            </div>
          </div>

          <div class="booking-extras" *ngIf="booking.hasExtraCot || booking.hasDeepClean">
            <strong>Extras:</strong>
            <span *ngIf="booking.hasExtraCot">ğŸ›ï¸ Extra Cot</span>
            <span *ngIf="booking.hasDeepClean">ğŸ§¹ Deep Clean</span>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="bookings.length === 0" class="empty-state">
      <p>ğŸ“­ No bookings on your properties yet</p>
    </div>
  </div>

  <!-- ==================== TAB 4: SUBMIT COMPLAINT ==================== -->
  <div *ngIf="activeTab === 'complaints'" class="tab-content">
    <div class="content-header">
      <h2>Submit a Complaint</h2>
    </div>

    <div class="complaint-form-container">
      <button class="btn btn-primary" (click)="openComplaintForm()" *ngIf="!showComplaintForm">
        â• New Complaint
      </button>

      <div class="form-card" *ngIf="showComplaintForm">
        <h3>Submit Complaint</h3>
        <form (ngSubmit)="submitComplaint()">
          <div class="form-group">
            <label>Booking ID (Optional)</label>
            <input type="number" [(ngModel)]="complaintForm.bookingId" name="bookingId" class="form-control"
              placeholder="Enter booking ID if related to a specific booking">
          </div>

          <div class="form-group">
            <label>Complaint Type *</label>
            <select [(ngModel)]="complaintForm.complaintType" name="complaintType" class="form-control" required>
              <option value="PROPERTY">Property Related</option>
              <option value="USER">User Related</option>
              <option value="BOOKING">Booking Related</option>
              <option value="PAYMENT">Payment Related</option>
              <option value="OTHER">Other</option>
            </select>
          </div>

          <div class="form-group">
            <label>Complaint Description *</label>
            <textarea [(ngModel)]="complaintForm.complaintDescription" name="complaintDescription" class="form-control"
              rows="5" placeholder="Describe your complaint in detail (10-1000 characters)" required minlength="10"
              maxlength="1000"></textarea>
            <small>{{ complaintForm.complaintDescription.length }}/1000 characters</small>
          </div>

          <div class="form-actions">
            <button type="submit" class="btn btn-primary">Submit Complaint</button>
            <button type="button" class="btn btn-secondary" (click)="cancelComplaintForm()">Cancel</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- ==================== PROPERTY DETAILS MODAL ==================== -->
  <div class="modal-overlay" *ngIf="selectedProperty" (click)="closePropertyDetails()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <button class="close-btn" (click)="closePropertyDetails()">âœ•</button>

      <div class="modal-header">
        <h2>{{ selectedProperty.propertyName }}</h2>
        <span class="badge" [ngClass]="getStatusBadgeClass(selectedProperty.propertyStatus)">
          {{ selectedProperty.propertyStatus }}
        </span>
      </div>

      <div class="modal-body">
        <img [src]="selectedProperty.imageURL || 'assets/placeholder-property.jpg'"
          [alt]="selectedProperty.propertyName" class="modal-image">

        <div class="details-section">
          <h3>Description</h3>
          <p>{{ selectedProperty.propertyDescription }}</p>
        </div>

        <div class="details-section">
          <h3>Property Details</h3>
          <div class="details-grid">
            <div><strong>Rooms:</strong> {{ selectedProperty.noOfRooms }}</div>
            <div><strong>Bathrooms:</strong> {{ selectedProperty.noOfBathrooms }}</div>
            <div><strong>Max Guests:</strong> {{ selectedProperty.maxNoOfGuests }}</div>
            <div><strong>Price:</strong> â‚¹{{ selectedProperty.pricePerDay }}/night</div>
          </div>
        </div>

        <div class="details-section">
          <h3>Address</h3>
          <p>
            {{ selectedProperty.buildingNo }}, {{ selectedProperty.street }}<br>
            {{ selectedProperty.city }}, {{ selectedProperty.state }} - {{ selectedProperty.postalCode }}<br>
            {{ selectedProperty.country }}
          </p>
        </div>

        <div class="details-section">
          <h3>Amenities</h3>
          <div class="amenities-list">
            <span *ngIf="selectedProperty.hasWifi">âœ… WiFi</span>
            <span *ngIf="!selectedProperty.hasWifi">âŒ WiFi</span>
            <span *ngIf="selectedProperty.hasParking">âœ… Parking</span>
            <span *ngIf="!selectedProperty.hasParking">âŒ Parking</span>
            <span *ngIf="selectedProperty.hasPool">âœ… Pool</span>
            <span *ngIf="!selectedProperty.hasPool">âŒ Pool</span>
            <span *ngIf="selectedProperty.hasAc">âœ… AC</span>
            <span *ngIf="!selectedProperty.hasAc">âŒ AC</span>
            <span *ngIf="selectedProperty.hasHeater">âœ… Heater</span>
            <span *ngIf="!selectedProperty.hasHeater">âŒ Heater</span>
            <span *ngIf="selectedProperty.hasPetFriendly">âœ… Pet Friendly</span>
            <span *ngIf="!selectedProperty.hasPetFriendly">âŒ Pet Friendly</span>
          </div>
        </div>

        <div class="details-section">
          <h3>Rating</h3>
          <div class="rating-display">
            <span class="stars">{{ getRatingStars(selectedProperty.propertyRate) }}</span>
            <span>{{ selectedProperty.propertyRate.toFixed(1) }} out of 5</span>
            <span>({{ selectedProperty.propertyRatingCount }} reviews)</span>
          </div>
        </div>

        <div class="details-section">
          <h3>Host Information</h3>
          <p>
            <strong>Name:</strong> {{ selectedProperty.hostName }}<br>
            <strong>Phone:</strong> {{ selectedProperty.hostPhone }}
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- ==================== ADD/EDIT PROPERTY MODAL ==================== -->
  <div class="modal-overlay" *ngIf="showPropertyForm" (click)="cancelPropertyForm()">
    <div class="modal-content large" (click)="$event.stopPropagation()">
      <button class="close-btn" (click)="cancelPropertyForm()">âœ•</button>

      <div class="modal-header">
        <h2>{{ isEditMode ? 'Edit Property' : 'Add New Property' }}</h2>
      </div>

      <div class="modal-body">
        <form (ngSubmit)="submitPropertyForm()">
          <!-- Basic Information -->
          <div class="form-section">
            <h3>Basic Information</h3>

            <div class="form-group">
              <label>Property Name *</label>
              <input type="text" [(ngModel)]="propertyForm.propertyName" name="propertyName" class="form-control"
                placeholder="e.g., Cozy Beach Villa" required minlength="5" maxlength="100" #name="ngModel">
              <div class="text-danger" *ngIf="name.invalid && name.touched">
                <small *ngIf="name.errors?.['required']">Property Name Required</small>
              </div>
            </div>

            <div class="form-group">
              <label>Description *</label>
              <textarea [(ngModel)]="propertyForm.propertyDescription" name="propertyDescription" class="form-control"
                rows="4" placeholder="Describe your property (20-1000 characters)" required minlength="20"
                maxlength="1000" #descp="ngModel"></textarea>
              <div class="text-danger" *ngIf="descp.invalid && descp.touched">
                <small *ngIf="descp.errors?.['required']">Property Description Required</small>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Number of Rooms *</label>
                <input type="number" [(ngModel)]="propertyForm.noOfRooms" name="noOfRooms" class="form-control"
                  #noOfRooms="ngModel" min="1" required />
                <div class="text-danger" *ngIf="noOfRooms.invalid && noOfRooms.touched">
                  <small *ngIf="noOfRooms.errors?.['min']">Must have atleast 1 room</small>
                </div>
              </div>

              <div class="form-group">
                <label>Number of Bathrooms *</label>
                <input type="number" [(ngModel)]="propertyForm.noOfBathrooms" name="noOfBathrooms" class="form-control"
                  #noOfBathrooms="ngModel" min="1" required>
                <div class="text-danger" *ngIf="noOfBathrooms.invalid && noOfBathrooms.touched">
                  <small *ngIf="noOfBathrooms.errors?.['min']">Must have atleast 1 bathroom</small>
                </div>
              </div>

              <div class="form-group">
                <label>Max Guests *</label>
                <input type="number" [(ngModel)]="propertyForm.maxNoOfGuests" name="maxNoOfGuests" class="form-control"
                  #maxNoOfGuests="ngModel" min="1" required>
                <div class="text-danger" *ngIf="maxNoOfGuests.invalid && maxNoOfGuests.touched">
                  <small *ngIf="maxNoOfGuests.errors?.['min']">Must allow atleast 1 guest</small>
                </div>
              </div>

            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Price Per Day (â‚¹) *</label>
                <input type="number" [(ngModel)]="propertyForm.pricePerDay" name="pricePerDay" class="form-control"
                  min="10" step="100" #pricePerDay="ngModel" required>

                <div class="text-danger" *ngIf="pricePerDay.invalid && pricePerDay.touched">
                  <small *ngIf="pricePerDay.errors?.['min']">Price must be greater than 10</small>
                </div>
              </div>

              <div class="form-group" *ngIf="isEditMode">
                <label>Property Status *</label>
                <select [(ngModel)]="propertyForm.propertyStatus" name="propertyStatus" class="form-control" required>
                  <option value="AVAILABLE">Available</option>
                  <option value="UNAVAILABLE">Unavailable</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label>Image URL *</label>
              <input type="url" [(ngModel)]="propertyForm.imageURL" name="imageURL" class="form-control"
                placeholder="https://example.com/property-image.jpg" #image="ngModel" required>
              <div class="text-danger" *ngIf="image.invalid && image.touched">
                <small *ngIf="image.errors?.['required']">Image URL Required</small>
              </div>
            </div>
          </div>

          <!-- Address Information -->
          <div class="form-section">
            <h3>Address</h3>

            <div class="form-row">
              <div class="form-group">
                <label>Building No *</label>
                <input type="text" [(ngModel)]="propertyForm.buildingNo" name="buildingNo" class="form-control"
                  required>
              </div>

              <div class="form-group">
                <label>Street *</label>
                <input type="text" [(ngModel)]="propertyForm.street" name="street" class="form-control" required>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>City *</label>
                <input type="text" [(ngModel)]="propertyForm.city" name="city" class="form-control" required>
              </div>

              <div class="form-group">
                <label>State *</label>
                <input type="text" [(ngModel)]="propertyForm.state" name="state" class="form-control" required>
              </div>

              <div class="form-group">
                <label>Country *</label>
                <input type="text" [(ngModel)]="propertyForm.country" name="country" class="form-control" required>
              </div>
            </div>

            <div class="form-group">
              <label>Postal Code *</label>
              <input type="text" [(ngModel)]="propertyForm.postalCode" name="postalCode" class="form-control"
                pattern="^\d{6}$" placeholder="6-digit postal code" required>
            </div>
            <small class="text-danger" *ngIf="
                !propertyForm.buildingNo ||
                !propertyForm.street ||
                !propertyForm.city ||
                !propertyForm.state ||
                !propertyForm.country ||
                !propertyForm.postalCode ||
                propertyForm.postalCode.length !== 6
              ">
              Please fill out all address fields correctly.
            </small>
          </div>

          <!-- Amenities -->
          <div class="form-section">
            <h3>Amenities</h3>

            <div class="amenities-checkboxes">
              <label class="checkbox-label">
                <input type="checkbox" [(ngModel)]="propertyForm.hasWifi" name="hasWifi">
                <span>ğŸ“¶ WiFi</span>
              </label>

              <label class="checkbox-label">
                <input type="checkbox" [(ngModel)]="propertyForm.hasParking" name="hasParking">
                <span>ğŸ…¿ï¸ Parking</span>
              </label>

              <label class="checkbox-label">
                <input type="checkbox" [(ngModel)]="propertyForm.hasPool" name="hasPool">
                <span>ğŸŠ Swimming Pool</span>
              </label>

              <label class="checkbox-label">
                <input type="checkbox" [(ngModel)]="propertyForm.hasAc" name="hasAc">
                <span>â„ï¸ Air Conditioning</span>
              </label>

              <label class="checkbox-label">
                <input type="checkbox" [(ngModel)]="propertyForm.hasHeater" name="hasHeater">
                <span>ğŸ”¥ Heater</span>
              </label>

              <label class="checkbox-label">
                <input type="checkbox" [(ngModel)]="propertyForm.hasPetFriendly" name="hasPetFriendly">
                <span>ğŸ• Pet Friendly</span>
              </label>
            </div>
          </div>

          <div class="form-actions">
            <button type="submit" class="btn btn-primary">
              {{ isEditMode ? 'Update Property' : 'Add Property' }}
            </button>
            <button type="button" class="btn btn-secondary" (click)="cancelPropertyForm()">
              Cancel
            </button>
          </div>
        </form>
      </div>
    </div>